---
title: "基础的 SCF 小程序"
comments: True
permalink: /post/SCF_Simple_Prog/
categories: [基础量子化学]
excerpt: "这篇文档是一个非常简单的，通过 Gaussian 输出读取电子积分，用自己写的程序实现 SCF 的简要说明．相信这是所有学习量子化学的本科生或研究生所必然经过的过程．"
keywords: SCF, HF, 自洽场, 量子化学程序
---

# 摘要

这篇文档是一个非常简单的，通过 Gaussian 输出读取电子积分，用自己写的程序实现 SCF 的简要说明．相信这是所有学习量子化学的本科生或研究生所必然经过的过程．

# 缘起

这两天在尝试看浙大的数据结构慕课，第一次知道计算机学生平时刷题的题目，感觉这些题目的设置很有意思：对于一个比较大的工作，也许题目中已经给了一些不太重要的代码，或者给了程序设计的大致框架，而剩下关键的内容需要读者自己填写．这可以帮助引导读者的学习进程，同时不让读者耗费太多精力在无用功或者繁杂的读写工作上．同时，出题者准备若干份测试程序，只要读者的输出能够与测试程序输出一致，那么读者应当一定正确无误地完成了工作．

(嘛，看到函数题的“细节不表”时，整个人是崩溃的 =▽=)

受到这些启发，我想我可以试着写一个小题目，让读者试着通过已有的程序框架，来填入他们需要的信息，最终做到输出与标准程序相同的结果，来确定他们程序的正确与否．

这个程序不打算写得很高效或者很泛用，我本人也并非专精于程序或计算化学的计算方法方向；我只是希望它能帮助大家对 Hartree-Fock 方法的 SCF 实现有一个直观与经验性的理解．

# 背景基础

这个 SCF 小程序是基于 Szabo, Ostlund 等人的经典教材 Modern Quantum Chemistry 所提供的 SCF 过程写的．相信所有学习过量子化学 (或者部分经过化学研究生学习) 的人必然经历过 SCF 小程序的书写；或者至少学习过 Szabo 的书．这份文档是写给学习过 Szabo 书籍，但还没有经历过 SCF 小程序书写的人．因此，这里假定读者已经完全熟悉书上第 3 章的公式．若是现在还没有学习第 4 章，这份程序仍然是可以做的；并且我相信完成这个程序与理解 SCF 过程之后，会对 Hartree-Fock 方法的不足有清晰的与经验上的认识，这对理解为何要在 HF 方法上作改进有很大的帮助．

# 目标与实现

* 我们需要计算两个分子的 Hartree-Fock 解：H2O 分子 (6-31G) 与苯 (STO-3G)；
* 我们现在通过 Gaussian 软件算出了电子积分 (包括基组重叠矩阵、单电子积分矩阵、双电子积分等等)，因此这里不使用 Szabo 书中的附录 A；
* 读入并借助于上述的电子积分，我们通过自己的程序实现 Hartree-Fock 的电子态能量、轨道能与轨道系数；
* 我们打算使用 Python 3 与 Numpy 来实现；
* 其中的程序框架与程序输出的工具已经准备好了，剩下来的是函数填空工作．

为了达到上述目标，我们需要
1. 创建一个工作文件夹，放入程序 [`Test_H2O.py`](/assets/files/2018-10-01-SCF_Simple_Prog/Test_H2O.py)、[`Test_C6H6.py`](/assets/files/2018-10-01-SCF_Simple_Prog/Test_C6H6.py)、[`SCF_Program.py`](/assets/files/2018-10-01-SCF_Simple_Prog/SCF_Program.py)；
2. 在 `Gaussian` 子文件夹下，书写 H2O 分子的[输入卡](/assets/files/2018-10-01-SCF_Simple_Prog/H2O.gjf) 与 C6H6 分子的[输入卡](/assets/files/2018-10-01-SCF_Simple_Prog/C6H6.gjf)，其中的输入卡指令保证输出的电子积分与 Szabo 书上所给出的公式基本相同；
3. 通过 Gaussian 09 软件，计算上述分子，并给出结果到 `H2O.out` 与 `C6H6.out` 中，仔细研读这两个输出文件的信息；
4. 在没有修改任何程序的情况下，先试一下执行 `Test_H2O.py`，应当能给出执行信息，并发现程序在输出双电子积分时报错；
5. 在 `SCF_Program.py` 中，按照指示，填入必要的代码：
    * 所有程序中包含代码 `pass` 的部分，都应当被修改；
    * 你也可以在指定区域以外进行函数定义，方便程序的书写 (在我所提供的[答案](/assets/files/2018-10-01-SCF_Simple_Prog/SCF_Program_Answer.py)中，就包含了额外的函数 `ltouts_to_symm_matrix`)；
    * 类 `Molecule.__init__` 没有必要，也不应当被修改，因为其中的定义在应付 SCF 程序时应当足够充分了；
    * 关于程序输出的内容也不必要、不应当被修改，因为这些代码在测试时控制输出结果；
    * 初始密度矩阵的初猜是零矩阵；
6. 在修改程序时，首先要从输出文件读入必要的轨道数量等信息，因为在读入电子积分时需要这些信息；
7. 其次读入电子积分，一般 Gaussian 使用下三角矩阵显示电子积分，在我们的程序中就把它转为实对称矩阵；
    * 尽管读入电子积分是繁杂的工作，但我认为如果没有经历过爬虫或数据库文件提取工作，那么读入 Gaussian 程序输出的积分的工作将会是一次不错的文本处理的经验；
8. 完成 SCF 部分
    * `SCF_Program.py` 在方法 `Molecule.scf_rhf()` 只提供了一部分的定义，剩余的部分需要读者按照自己的需求给出；
9. 成品程序的输出应当与 [`Test_H2O.log`](/assets/files/2018-10-01-SCF_Simple_Prog/Test_H2O.log)、[`Test_C6H6.log`](/assets/files/2018-10-01-SCF_Simple_Prog/Test_C6H6.log) 相同或类似．

# 一些提示
1. 在对分子轨道基组的 Fock 矩阵求本征问题 (对角化) 时，可以考虑使用 [`np.linalg.eigh`](https://docs.scipy.org/doc/numpy/reference/generated/numpy.linalg.eigh.html)，它自动地对本征向量按照本征值的大小进行了排序；
2. 在处理双电子积分的角标求和时，可以使用 [`np.einsum`](https://docs.scipy.org/doc/numpy/reference/generated/numpy.einsum.html)，它使用非常直观的字符串来处理角标求和；
3. 注意分子轨道基组的密度矩阵的迹始终与电子数保持 1 倍或 2 倍的关系，而非与基组大小保持倍数关系；这也提醒我们，得到 Hartree-Fock 的能量其实不需要对分子轨道基组 Fock 矩阵作彻底的对角化，而只需要求出占据轨道数量的分子轨道系数，或者对应的密度矩阵即可．因此，这里的基于 Fock 矩阵完全对角化的 Roothaan 方程并不是高效的解法．
